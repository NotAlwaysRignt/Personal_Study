## 跳板机自动同步编译文件小技巧
> 技巧源于skyyuan的分享，原文只给了代码和使用，没有涉及到安装（配置环境）的过程，自己在这一过程中踩了许多坑，特此记录一下，同步代码[下载](http://km.oa.com/group/1397/attachments/attachment_view/148141)，链接中可以转到sky的原文。

由于源码比较简单，而且有readme文件，下面对程序的原理和使用不做过多分析，主要记录配置环境的重要过程  

### 到开发机上拉取安装expect
开发机上已经安装了expect,跳板机和开发机环境是一致的,因此到开发机上拉下来即可

程序所需要的环境主要是expect命令，该命令也会依赖一些其他的命令和库，所以要在跳板机上安装该命令和相关的库，但由于运维的限制，跳板机上几乎什么命令都不能用，更不要说安装东西了，所以我们只能采取从开发机上拉取执行文件的方法，简单记录拉取过程注意的几点
- 拉取命令：scp,使用大概是这样`scp -r harveyyue@10.123.10.10:/data/home/harveyyue/demo_tmp.xml ./`
- 需要拉取的文件：开发机`/usr/bin`目录下expect文件，`/usr/lib64/`下的`libexpect5.44.1.15.so` `libtcl8.5.so`文件，以及`/usr/share/tcl8.5`整个目录文件，需要注意的是expect文件和so文件放的目录位置可以随意一点，只要把放的目录加到环境变量和共享库的环境变量中就可以了，`tcl8.5`文件有几个目录可以选择，我选的目录如下`/data/home/harveyyue/lib/tcl8.5`，文件大概就是这些，有遗漏的话执行命令会提示找不到XXX，自己慢慢找就是了。以上有问题的话，可以先拉expect文件，然后执行，根据提示一点点把需要的文件拉下来，直到该命令可以使用

- 设置环境变量：我做的时候不知道踩了什么坑，添加了环境变量scp就不能用了，后来稍微调整了下姿势才没有问题，记录一下添加的命令  
`export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/data/home/harveyyue/lib64`  
`export PATH=$PATH:/data/home/harveyyue/bin`  
由于跳板机没有修改`/etc/profile`的权限，所以每次登陆跳板机都需要执行这两个命令，可以把这两个命令添加到Xshell的登陆脚本中
- sh文件上传到跳板机可能没有执行权限，跳板机也没有chmod命令，所以可以先把文件传到开发机，全给777权限，然后scp拉下来就是可执行的

最后引用一下sky关于该脚本的使用说明
>这个脚本在跳板机上运行.  
>一般我们的编译机是固定的, 目标机器的用户名和密码也是固定的.
>所以这里只需要提供编译机的路径, 需要传输的文件名, 目标机器的ip和目标机器的路径即可传输文件.
>下载该工具后修改_scp.sh文件, 修改自己的编译机信息即可.  

>需要修改的变量如下:  
>compileHost=10.123.10.10  编译机IP
>compileUsername=skyyuan   编译机用户名
>compilePassword=skyyuan   编译机密码
>tmpPath=/cfs/m_skyyuan/down/  编译机临时目录

>./_scp.sh 文件名 编译机路径 目标机器 目标路径
>./_scp.sh binfile /data/home/skyyuan/spp/video_msg_bus/bin/ $ip /home/user_00/

